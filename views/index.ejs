<%- include('includes/start.ejs') %>
      <header class="app-header">
        <h1>Todo List</h1>
        <span><%= length  %> need to do, <%= done  %> done</span>
        <hr>
      </header>

      <main>
        <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
          <div class="alert alert-danger">
            <ul>
              <% errors.forEach(error => { %>
                <li><%= error %></li>
              <% }) %>
            </ul>
          </div>
        <% } %>
        <form action="/tasks" method="POST" class="panel-add-item">
          <div class="panel-add-item-block">
            <input class="form-control panel-add-item-input"
            type="text" placeholder="Write title of your task" aria-label="add task title" name="title" autocomplete="on" value="<%= typeof formData !== 'undefined' ? formData.title : '' %>">
            <select class="form-control" name="status">
              <option value="todo" <%= formData?.status === 'todo' ? 'selected' : '' %>>ToDo</option>
              <option value="in-progress" <%= formData?.status === 'in-progress' ? 'selected' : '' %>>In progress</option>
              <option value="done" <%= formData?.status === 'done' ? 'selected' : '' %>>Done</option>
            </select>
          </div>
          
          <textarea class="form-control panel-add-item-input" name="description" id="description" aria-label="add task description" rows="2" placeholder="Write description of your task" autocomplete="on"><%= typeof formData !== 'undefined' ? formData.description : '' %></textarea>
          <button type="submit"
            class="btn btn-warning ms-2">Add</button>
        </form>
        <hr>
        <div class="btn-group-filter" role="group">
          <a href="/tasks" type="button" class="btn">
            <svg class="filter-icon all-icon" xmlns="http://www.w3.org/2000/svg" alt="edit" viewBox="0 0 512 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
                <path d="M352.9 21.2L308 66.1 445.9 204 490.8 159.1C504.4 145.6 512 127.2 512 108s-7.6-37.6-21.2-51.1L455.1 21.2C441.6 7.6 423.2 0 404 0s-37.6 7.6-51.1 21.2zM274.1 100L58.9 315.1c-10.7 10.7-18.5 24.1-22.6 38.7L.9 481.6c-2.3 8.3 0 17.3 6.2 23.4s15.1 8.5 23.4 6.2l127.8-35.5c14.6-4.1 27.9-11.8 38.7-22.6L412 237.9 274.1 100z"/>
              </svg>
            All</a>
          <a href="/tasks?status=todo" type="button" class="btn">
            <svg class="filter-icon todo-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
              <path d="M32 32C32 14.3 46.3 0 64 0L320 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-29.5 0 10.3 134.1c37.1 21.2 65.8 56.4 78.2 99.7l3.8 13.4c2.8 9.7 .8 20-5.2 28.1S362 352 352 352L32 352c-10 0-19.5-4.7-25.5-12.7s-8-18.4-5.2-28.1L5 297.8c12.4-43.3 41-78.5 78.2-99.7L93.5 64 64 64C46.3 64 32 49.7 32 32zM160 400l64 0 0 112c0 17.7-14.3 32-32 32s-32-14.3-32-32l0-112z"/>
            </svg>
            To Do</a>
          <a href="/tasks?status=in-progress" type="button" class="btn">
            <svg class="filter-icon process-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!--><path d="M208 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm0 416a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zM48 208a48 48 0 1 1 0 96 48 48 0 1 1 0-96zm368 48a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zM75 369.1A48 48 0 1 1 142.9 437 48 48 0 1 1 75 369.1zM75 75A48 48 0 1 1 142.9 142.9 48 48 0 1 1 75 75zM437 369.1A48 48 0 1 1 369.1 437 48 48 0 1 1 437 369.1z"/></svg>
            In Process</a>
          <a href="/tasks?status=done" type="button" class="btn">
            <svg class="filter-icon done-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
              <path d="M434.8 70.1c14.3 10.4 17.5 30.4 7.1 44.7l-256 352c-5.5 7.6-14 12.3-23.4 13.1s-18.5-2.7-25.1-9.3l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l101.5 101.5 234-321.7c10.4-14.3 30.4-17.5 44.7-7.1z"/>
            </svg>
            Done</a>
        </div>
        <ul class="todo-list">
          <% tasks.forEach(task => { %>
           <li class="list-group-item" data-status="<%= task.status %>">
            <a href="/tasks/<%= task.id %>">
            <h3><%= task.title %></h3></a>
            <span class="todo-list-item"><span class="todo-list-item-label"><%= task.description %></span>
            <% if (!task.modifiedAt) { %>
              <% 
              const dateCreated = new Date(task.createdAt);
              const date = `${String(dateCreated.getDate()).padStart(2, '0')}/${String(dateCreated.getMonth() + 1).padStart(2, '0')}/${dateCreated.getFullYear().toString().slice(2)}`;
              const time = `${String(dateCreated.getHours()).padStart(2, '0')}:${String(dateCreated.getMinutes()).padStart(2, '0')}:${String(dateCreated.getSeconds()).padStart(2, '0')}`;
              const line = `[${date} ${time}]`;
              %>
  
              <span class="span-timeline">Created: <%= line %>    </span>
            <% } else { %>
              <% 
              const dateModified = new Date(task.modifiedAt);

              const date = `${String(dateModified.getDate()).padStart(2, '0')}/${String(dateModified.getMonth() + 1).padStart(2, '0')}/${dateModified.getFullYear().toString().slice(2)}`;
              const time = `${String(dateModified.getHours()).padStart(2, '0')}:${String(dateModified.getMinutes()).padStart(2, '0')}:${String(dateModified.getSeconds()).padStart(2, '0')}`;
              const line2 = `[${date} ${time}]`;
               %>
              <span class="span-timeline">Modified: <%= line2 %>    </span>
            <% } %>
            <button type="button" class="btn btn-edit btn-sm">
              <svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" alt="edit" viewBox="0 0 512 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
                <path d="M352.9 21.2L308 66.1 445.9 204 490.8 159.1C504.4 145.6 512 127.2 512 108s-7.6-37.6-21.2-51.1L455.1 21.2C441.6 7.6 423.2 0 404 0s-37.6 7.6-51.1 21.2zM274.1 100L58.9 315.1c-10.7 10.7-18.5 24.1-22.6 38.7L.9 481.6c-2.3 8.3 0 17.3 6.2 23.4s15.1 8.5 23.4 6.2l127.8-35.5c14.6-4.1 27.9-11.8 38.7-22.6L412 237.9 274.1 100z"/>
              </svg>
              </button>
              <button type="button" class="btn btn-danger btn-sm">
                <svg class="delete-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
                  <path d="M136.7 5.9C141.1-7.2 153.3-16 167.1-16l113.9 0c13.8 0 26 8.8 30.4 21.9L320 32 416 32c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 96C14.3 96 0 81.7 0 64S14.3 32 32 32l96 0 8.7-26.1zM32 144l384 0 0 304c0 35.3-28.7 64-64 64L96 512c-35.3 0-64-28.7-64-64l0-304zm88 64c-13.3 0-24 10.7-24 24l0 192c0 13.3 10.7 24 24 24s24-10.7 24-24l0-192c0-13.3-10.7-24-24-24zm104 0c-13.3 0-24 10.7-24 24l0 192c0 13.3 10.7 24 24 24s24-10.7 24-24l0-192c0-13.3-10.7-24-24-24zm104 0c-13.3 0-24 10.7-24 24l0 192c0 13.3 10.7 24 24 24s24-10.7 24-24l0-192c0-13.3-10.7-24-24-24z"/>
                </svg>
              </button></span>
            <input type="hidden" name="id" value="<%= task.id %>">
            </li>
            <hr>
          <% }) %>
          

        </ul>

      </main>

    </div>
  </div>
  <button id="theme-toggle" class="change-theme-btn">
    <svg class="change-theme-icon change-theme-icon_moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2026 Fonticons, Inc.!-->
      <path d="M239.3 48.7c-107.1 8.5-191.3 98.1-191.3 207.3 0 114.9 93.1 208 208 208 33.3 0 64.7-7.8 92.6-21.7-103.4-23.4-180.6-115.8-180.6-226.3 0-65.8 27.4-125.1 71.3-167.3zM0 256c0-141.4 114.6-256 256-256 19.4 0 38.4 2.2 56.7 6.3 9.9 2.2 17.3 10.5 18.5 20.5s-4 19.8-13.1 24.4c-60.6 30.2-102.1 92.7-102.1 164.8 0 101.6 82.4 184 184 184 5 0 9.9-.2 14.8-.6 10.1-.8 19.6 4.8 23.8 14.1s2 20.1-5.3 27.1C387.3 484.8 324.8 512 256 512 114.6 512 0 397.4 0 256z"/>
    </svg>
  </button>
</body>

</html>